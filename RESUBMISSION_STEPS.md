# App Store 再申請手順

このドキュメントに従って、App Storeへの再申請を行ってください。

---

## ✅ 完了した対応

### 1. Guideline 2.1 - カメラクラッシュ
- `ios/App/App/Info.plist` にカメラ権限の説明を追加
- コミット: `f456887`

### 2. Guideline 1.2 - 通報・ブロック機能
- API実装（reportUser, blockUser, unblockUser, getBlockedUsers, isUserBlocked）
- プロフィール画面に3点メニューと通報・ブロック機能を追加
- フィードからブロックユーザーを除外するロジック実装
- コミット: `c4db9ff`

### 3. Guideline 5.1.2 - トラッキング
- 審査に関する注記で「トラッキングを行っていない」ことを説明

---

## ステップ1: Xcodeで実機テスト（30分）

### 1-1. Xcodeプロジェクトを開く

```bash
cd /path/to/livme
open ios/App/App.xcworkspace
```

⚠️ **重要**: `App.xcodeproj` ではなく `App.xcworkspace` を開いてください

### 1-2. 実機を接続

1. iPhoneをUSBケーブルでMacに接続
2. Xcodeのツールバーでデバイスを選択（例: "iPhone 15"）
3. 必要に応じて「Trust This Computer」を選択

### 1-3. ビルド設定の確認

1. Xcodeでプロジェクト設定を開く
2. 「General」タブで以下を確認：
   - **Bundle Identifier**: `com.livme.app`
   - **Version**: `3.0`（または次のバージョン番号）
   - **Build**: 自動で増加するか確認
   - **Signing & Capabilities**: 自分の開発者アカウントを選択

### 1-4. ビルド＆実行

1. Xcodeで `Cmd + R` または ▶️ ボタンをクリック
2. アプリが実機にインストールされ、起動する

### 1-5. 実機でテスト

#### ✅ カメラアクセステスト（最重要）
1. アプリにログイン
2. 右上のアバターをタップ → プロフィール画面
3. 「プロフィール画像を変更」をタップ
4. 「画像をアップロード」をタップ
5. 「Take Photo」をタップ
6. **カメラ権限のダイアログが表示される**
7. 「許可」をタップ
8. **カメラが起動する（クラッシュしない）** ✅

#### ✅ 通報機能テスト
1. ホーム画面でライブイベントの参加者アイコンをタップ
2. 参加者リストから他のユーザーをタップ
3. フォローボタンの横の「︙」（3点メニュー）をタップ
4. 「通報」をタップ
5. 通報理由を選択
6. 「通報する」をタップ
7. **「通報しました」のトーストが表示される** ✅

#### ✅ ブロック機能テスト
1. ホーム画面でライブイベントの参加者アイコンをタップ
2. 参加者リストから他のユーザーをタップ
3. フォローボタンの横の「︙」（3点メニュー）をタップ
4. 「ブロック」をタップ
5. 確認ダイアログで「ブロック」を選択
6. **ブロックしたユーザーがリストから消える** ✅
7. ホーム画面に戻って、ブロックしたユーザーのライブが表示されないことを確認

#### ✅ ブロック解除テスト
1. ブロックしたユーザーのプロフィールに直接アクセス（URLから）
2. 「︙」（3点メニュー）→「ブロック解除」
3. **ブロックが解除され、ユーザーが再度表示される** ✅

---

## ステップ2: Xcodeでアーカイブを作成（20分）

### 2-1. アーカイブの準備

1. Xcodeでデバイスを **"Any iOS Device (arm64)"** に変更
2. メニューバー → **Product** → **Clean Build Folder** (`Cmd + Shift + K`)

### 2-2. アーカイブの作成

1. メニューバー → **Product** → **Archive**
2. ビルドが完了するまで待つ（5-10分）
3. **Organizer** ウィンドウが自動的に開く

### 2-3. App Store Connectにアップロード

1. Organizerで最新のアーカイブを選択
2. **Distribute App** をクリック
3. **App Store Connect** を選択 → **Next**
4. **Upload** を選択 → **Next**
5. 必要に応じて以下を設定：
   - **Automatically manage signing**: チェック
   - **Upload symbols**: チェック（推奨）
6. **Upload** をクリック
7. アップロードが完了するまで待つ（5-15分）

---

## ステップ3: App Store Connectで設定（10分）

### 3-1. App Store Connectにログイン

https://appstoreconnect.apple.com

### 3-2. ビルドが処理されるまで待つ

- アップロード後、ビルドが「処理中」になります
- 通常10-30分で「処理完了」になります
- メールで通知が届きます

### 3-3. アプリバージョンの編集

1. **マイApp** → **LiVME** を選択
2. 左側のメニューから **iOS App** を選択
3. 現在のバージョン（例: 3.0）を選択

### 3-4. ビルドを選択

1. **ビルド** セクションまでスクロール
2. 「+」アイコンまたは「ビルドを選択」をクリック
3. 最新のビルド（先ほどアップロードしたもの）を選択

### 3-5. 審査に関する注記を追加

1. **App審査情報** セクションまでスクロール
2. **審査に関する注記** フィールドに、`APP_STORE_REVIEW_NOTES.md` の内容をコピー＆ペースト

**推奨**: 日本語版と英語版の両方を記載してください。

### 3-6. App情報を確認

1. 左側のメニューから **App情報** を選択
2. 以下が設定されていることを確認：
   - **プライバシーポリシーURL**: 設定済みか確認
   - **利用規約URL**: 設定済みか確認
   - **サポートURL**: 設定済みか確認

---

## ステップ4: 審査に提出（5分）

### 4-1. 最終確認

- ビルドが選択されている
- 審査に関する注記が記載されている
- スクリーンショットが最新である（必要に応じて更新）
- App情報がすべて記載されている

### 4-2. 審査に提出

1. バージョンページの右上にある **審査に提出** ボタンをクリック
2. 確認画面で内容を確認
3. **送信** をクリック

### 4-3. ステータスの確認

- ステータスが **「審査待ち」** に変わります
- 通常、1-3日で審査結果が通知されます

---

## ✅ 完了チェックリスト

実機テスト:
- [ ] カメラアクセスがクラッシュしない
- [ ] 通報機能が正常に動作する
- [ ] ブロック機能が正常に動作する
- [ ] ブロックしたユーザーがフィードから消える
- [ ] ブロック解除が正常に動作する

App Store Connect設定:
- [ ] 最新のビルドをアップロード完了
- [ ] ビルドがバージョンに選択されている
- [ ] 審査に関する注記を記載
- [ ] プライバシーポリシーURL、利用規約URL、サポートURLが設定されている

提出:
- [ ] 審査に提出完了
- [ ] ステータスが「審査待ち」になっている

---

## トラブルシューティング

### ビルドエラーが発生した場合

1. **CocoaPods関連のエラー**
   ```bash
   cd ios/App
   pod install
   pod update
   ```

2. **署名エラー**
   - Xcode → **Signing & Capabilities** タブ
   - 開発者アカウントを再選択
   - 「Automatically manage signing」にチェック

3. **キャッシュをクリア**
   - Xcode → **Product** → **Clean Build Folder** (`Cmd + Shift + K`)
   - Derived Dataを削除: `~/Library/Developer/Xcode/DerivedData`

### アップロードエラーが発生した場合

1. **App Store Connect APIキーの問題**
   - Xcode → **Preferences** → **Accounts**
   - アカウントを削除して再追加

2. **ネットワークエラー**
   - インターネット接続を確認
   - VPNを無効にする

### 審査で再度リジェクトされた場合

1. **Resolution Center** で詳細を確認
2. 指摘された問題を解決
3. 新しいビルドを作成
4. 審査に関する注記を更新
5. 再申請

---

## 次回のアップデート時の注意点

今後のアップデートでは、以下の機能が引き続き動作することを確認してください：

1. **カメラ権限**: Info.plistの設定が削除されていないこと
2. **通報機能**: API関数が正常に動作すること
3. **ブロック機能**: フィルタリングロジックが正常に動作すること
4. **データベース**: reportsテーブルとblocksテーブルが存在すること

---

## サポート

問題が発生した場合は、以下を確認してください：

1. **Xcodeのバージョン**: 最新版を使用していますか？
2. **iOS SDKのバージョン**: 最新版を使用していますか？
3. **証明書の有効期限**: 期限切れになっていませんか？
4. **App Store Connect**: アカウントが有効ですか？

---

以上で再申請の準備が完了です。頑張ってください！🚀
